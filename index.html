<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css" integrity="sha256-xejo6yLi6vGtAjcMIsY8BHdKsLg7QynVlFMzdQgUuy8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"ssj1314.github.io","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.12.3","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="书中自有颜如玉">
<meta property="og:type" content="website">
<meta property="og:title" content="葫芦小金刚">
<meta property="og:url" content="https://ssj1314.github.io/index.html">
<meta property="og:site_name" content="葫芦小金刚">
<meta property="og:description" content="书中自有颜如玉">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="大福禄">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://ssj1314.github.io/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>葫芦小金刚</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>

<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">葫芦小金刚</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">宋帅杰</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">大福禄</p>
  <div class="site-description" itemprop="description">书中自有颜如玉</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">5</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://ssj1314.github.io/2022/09/02/Swift%E7%AC%AC%E4%B8%80%E8%8A%82%E8%AF%BE%E5%B1%9E%E6%80%A7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="大福禄">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="葫芦小金刚">
      <meta itemprop="description" content="书中自有颜如玉">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 葫芦小金刚">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/09/02/Swift%E7%AC%AC%E4%B8%80%E8%8A%82%E8%AF%BE%E5%B1%9E%E6%80%A7/" class="post-title-link" itemprop="url">Swift第一节课属性</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-09-02 09:07:46 / 修改时间：09:07:54" itemprop="dateCreated datePublished" datetime="2022-09-02T09:07:46+08:00">2022-09-02</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <hr>
<p>highlight: a11y-dark<br>theme: channing-cyan</p>
<hr>
<p>Swift中属性可分为两大类：存储属性（Stored Property），计算属性（Computed Property）。</p>
<h1 id="存储属性"><a href="#存储属性" class="headerlink" title="存储属性"></a><strong>存储属性</strong></h1><p>存储属性是一个作为类和结构体实例的一部分的常量或变量。存储要么是是变量存储属性（var声明变量，可在将来设置为不同的值）要么是常量存储属性（let声明常量，常量的值一旦设置好不能再被更改），存储属性可以说是类或结构体的成员变量，因为它和类或结构体的内存结构有关。</p>
<p><strong>let和var的对比</strong><br><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f0518fdeb35245de86d5020e6028d7b6~tplv-k3u1fbpfcp-watermark.image" alt="image.png"><br><strong>汇编分析两者</strong></p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9c3c9e38ed5a4539a13049f8b5d3f747~tplv-k3u1fbpfcp-watermark.image" alt="image.png"><br>汇编代码看没有区别，都是将值存储到了寄存器中</p>
<p><strong>lldb调试查看内存</strong><br><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/532d9fb60df949e3b0e6385579d766e5~tplv-k3u1fbpfcp-watermark.image" alt="image.png"><br>看到，x,y 在相邻的内存区域，连续的，都在__DATA.__common这个区域</p>
<p><strong>sil分析</strong><br>var get set<br>let get</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@_hasStorage @_hasInitialValue var x: Int { get set }</span><br><span class="line">@_hasStorage @_hasInitialValue let y: Int { get }</span><br></pre></td></tr></tbody></table></figure>
<h1 id="计算属性"><a href="#计算属性" class="headerlink" title="计算属性"></a><strong>计算属性</strong></h1><p>类、结构体、枚举都能够定义计算属性，但计算属性并不存储值，他们提供了setter和getter方法来修改和获取值。对于存储属性来说可以是常量或者变量，但对于计算属性必须定义为变量。与此同时我们书写计算属性时鼻血包含类型，因为编译器需要知道期望返回值是什么。</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">**</span><span class="keyword">struct</span>** <span class="title class_">square</span>{</span><br><span class="line"></span><br><span class="line">&nbsp; &nbsp; <span class="comment">//实例中占据内存</span></span><br><span class="line"></span><br><span class="line">&nbsp; &nbsp; <span class="operator">**</span><span class="keyword">var</span><span class="operator">**</span> width : <span class="type">Double</span></span><br><span class="line"></span><br><span class="line">&nbsp; &nbsp; <span class="comment">//不占用内存</span></span><br><span class="line"></span><br><span class="line">&nbsp; &nbsp; <span class="operator">**</span><span class="keyword">var</span><span class="operator">**</span> area:<span class="type">Double</span>{</span><br><span class="line"></span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; <span class="operator">**</span><span class="keyword">get</span><span class="operator">**</span>{</span><br><span class="line"></span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="operator">**</span><span class="keyword">return</span><span class="operator">**</span> width <span class="operator">*</span> width</span><br><span class="line"></span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; }<span class="operator">**</span><span class="keyword">set</span><span class="operator">**</span>{</span><br><span class="line"></span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="operator">**</span><span class="keyword">self</span><span class="operator">**</span>.width <span class="operator">=</span> newValue</span><br><span class="line"></span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; }</span><br><span class="line"></span><br><span class="line">&nbsp; &nbsp; }</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">\</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="operator">**</span><span class="keyword">var</span><span class="operator">**</span> s <span class="operator">=</span> square(width: <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">s.area <span class="operator">=</span> <span class="number">30</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(s.area)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"end"</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>s.area的本质是调用方法，我们将上面的代码转为sil文件</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">square</span> {</span><br><span class="line"></span><br><span class="line">&nbsp; <span class="meta">@_hasStorage</span> <span class="keyword">var</span> width: <span class="type">Double</span> { <span class="keyword">get</span> <span class="keyword">set</span> }</span><br><span class="line"></span><br><span class="line">&nbsp; <span class="keyword">var</span> area: <span class="type">Double</span> { <span class="keyword">get</span> <span class="keyword">set</span> }</span><br><span class="line"></span><br><span class="line">&nbsp; <span class="keyword">init</span>(<span class="params">width</span>: <span class="type">Double</span>)</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>可以看到area是没有hasStorage存储属性的，但width是有存储属性的，但是他们都有get和set方法，顾名思义可知，他们之间最大的差别就是一个可以记录存储值，一个仅仅调用set和get方法但并不存储该属性的值。</p>
<p>我们变换一下代码，我们将存储属性area的set方法私有化，并且定义一个height，我们将代码转换成sil文件看看区别：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/92dcaa4d33914ba9bf77081d3504ece9~tplv-k3u1fbpfcp-watermark.image" alt="image.png"><br>sil文件可以看到area是一个存储属性，set方法不能调用</p>
<p>总结：计算属性本质就是调用set和get方法。</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">square</span> {</span><br><span class="line"></span><br><span class="line">&nbsp; <span class="meta">@_hasStorage</span> <span class="keyword">var</span> width: <span class="type">Double</span> { <span class="keyword">get</span> <span class="keyword">set</span> }</span><br><span class="line"></span><br><span class="line">&nbsp; <span class="meta">@_hasStorage</span> <span class="meta">@_hasInitialValue</span> <span class="keyword">private(set)</span> <span class="keyword">var</span> area: <span class="type">Double</span> { <span class="keyword">get</span> <span class="keyword">set</span> }</span><br><span class="line"></span><br><span class="line">&nbsp; <span class="meta">@_hasStorage</span> <span class="meta">@_hasInitialValue</span> <span class="keyword">let</span> height: <span class="type">Double</span> { <span class="keyword">get</span> }</span><br><span class="line"></span><br><span class="line">&nbsp; <span class="keyword">func</span> <span class="title function_">test</span>()</span><br><span class="line"></span><br><span class="line">&nbsp; <span class="keyword">init</span>(<span class="params">width</span>: <span class="type">Double</span>, <span class="params">area</span>: <span class="type">Double</span> <span class="operator">=</span> <span class="number">40.0</span>)</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h1 id="属性观察者"><a href="#属性观察者" class="headerlink" title="属性观察者"></a><strong>属性观察者</strong></h1><ul>
<li>属性观察者用来观察属性值的变化，一个willSet再当属性将改变调用，即使这个值与原来的值相同，而didSet在属性已经改变之后调用。他们的语法类似于getter和setter</li>
<li>willSet会传递新值，默认叫newvalue，didset会传递旧值，默认叫oldVlaue。</li>
<li>在初始化器中设置属性值不会触发willSet和didSet，在属性定义设置初始值时也不会触发willSet和didSet。</li>
</ul>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fbdc35be13bb4f79abb4f82e5b459e47~tplv-k3u1fbpfcp-watermark.image" alt="WeChatf944604070cbad33664ed5d60169e204.png"></p>
<p> 属性观察者在继承关系下的调用顺序<br><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8a170c5772aa4634848d22f798c639fe~tplv-k3u1fbpfcp-watermark.image" alt="image.png"><br>调用顺序：子类&nbsp;<code>willSet</code>&nbsp;-&gt; 父类&nbsp;<code>willSet</code>&nbsp;-&gt; 父类&nbsp;<code>didSet</code>&nbsp;-&gt; 子类&nbsp;<code>didSet</code>。<br>全局变量和局部变量也可以使用属性观察器。</p>
<h1 id="延迟存储属性"><a href="#延迟存储属性" class="headerlink" title="延迟存储属性"></a><strong>延迟存储属性</strong></h1><figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>{</span><br><span class="line">    <span class="keyword">lazy</span> <span class="keyword">var</span> age : <span class="type">Int</span> <span class="operator">=</span> <span class="number">18</span></span><br><span class="line">}</span><br><span class="line"><span class="keyword">var</span> s <span class="operator">=</span> <span class="type">Subject</span>()</span><br><span class="line"><span class="built_in">print</span>(s.age)</span><br></pre></td></tr></tbody></table></figure>

<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/463de7af01294c0b986f5e1b27ac5393~tplv-k3u1fbpfcp-watermark.image" alt="image.png"><br>sil文件查看结构</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> {</span><br><span class="line"></span><br><span class="line">&nbsp; <span class="keyword">lazy</span> <span class="keyword">var</span> age: <span class="type">Int</span> { <span class="keyword">get</span> <span class="keyword">set</span> }</span><br><span class="line"></span><br><span class="line">&nbsp; <span class="meta">@_hasStorage</span> <span class="meta">@_hasInitialValue</span> <span class="keyword">final</span> <span class="keyword">var</span> <span class="variable">$__lazy_storage_</span><span class="variable">$_age</span>: <span class="type">Int</span>? { <span class="keyword">get</span> <span class="keyword">set</span> }</span><br><span class="line"></span><br><span class="line">&nbsp; <span class="keyword">@objc</span> <span class="keyword">deinit</span></span><br><span class="line"></span><br><span class="line">&nbsp; <span class="keyword">init</span>()</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>可以看到lazy修饰的age变成了一个<code>_age: Int? { get set }</code>可选类型，可选类型默认初始化为nil。延迟存储属性并不是线程安全的</p>
<h1 id="类型属性-Type-Property"><a href="#类型属性-Type-Property" class="headerlink" title="类型属性(Type Property)"></a><strong>类型属性(Type Property)</strong></h1><p>属性可以分为实例属性（instance Property）和类型属性（Type Property）。</p>
<h3 id="1。实例属性"><a href="#1。实例属性" class="headerlink" title="1。实例属性"></a>1。实例属性</h3><p>存储实例属性（stored Instance Property）：存储在实例的内存中，每个实例都有一份。<br>计算实例属性（computed Instance Property）：<br>实例属性只能通过实例去访问，在上面所讲的属性都属于实例属性。</p>
<h3 id="2-类型属性"><a href="#2-类型属性" class="headerlink" title="2.类型属性"></a>2.类型属性</h3><ul>
<li>存储类型属性（Stored Type Property）：整个程序运行过程中，就只有一份内存（类似于全局变量）。</li>
<li>计算类型属性（Computed Type Property）</li>
<li>可以通过static定义类型属性，如果是类，也可以用关键字class。<br>类型属性，只能通过类型去访问。在结构体中定义一个属性，可以通过static来修饰。</li>
</ul>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">**</span><span class="keyword">struct</span>** <span class="title class_">Car</span> {</span><br><span class="line">&nbsp; &nbsp; <span class="operator">**</span><span class="keyword">static</span><span class="operator">**</span> <span class="operator">**</span><span class="keyword">var</span><span class="operator">**</span> count:<span class="type">Int</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">}</span><br><span class="line"><span class="type">Car</span>.count <span class="operator">=</span> <span class="number">100</span></span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>不同于存储实例属性，你必须给存储类型属性定义初始值，因为类型没有实例那样的init初始化器取初始化值。</li>
<li>存储类型属性默认就是lazy，会在第一次使用的时候才初始化，就算被多个线程访问，也能保证只会初始化一次。</li>
<li>存储类型属性可以是let。</li>
<li>枚举类型也可以定义类型属性（存储、计算）</li>
</ul>
<h3 id="3-单例模式"><a href="#3-单例模式" class="headerlink" title="3.单例模式"></a>3.单例模式</h3><p>在oc中设计单例模式代码大致</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+（SSnetWorkManager *）sharedManger;</span><br><span class="line">+ (SSnetWorkManager *)sharedManger{</span><br><span class="line">    static SSnetWorkManager *instance = nil;</span><br><span class="line">    static dispatch_once_t onceToken;</span><br><span class="line">    dispatch_once(&amp;onceToken,^{</span><br><span class="line">        instance = [SSnetWorkManager alloc]init];</span><br><span class="line">    });</span><br><span class="line">    </span><br><span class="line">    return instance;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>在Swift中设计的单例代码如下</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SSNetWorkManager</span>{</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> shared <span class="operator">=</span> <span class="type">SSNetWorkManager</span>()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">init</span>(){}</span><br><span class="line">}</span><br><span class="line">或者</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SSSNetWorkManager</span>{</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> shared <span class="operator">=</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="type">SSSNetWorkManager</span>()</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">init</span>(){}</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>在初始化器 <code>init</code> 前用 <code>private</code> 修饰，可以将被修饰的初始化器进行私有，外部访问只能通过 shared 来进行访问。</p>
<p>在 OC 中，我们在设计单例模式的时候，为了保证线程安全，通常会配合 <code>dispatch_once</code> 来创建实例，以保证单例对象在内存中只有一份。但在写 <code>Swift</code> 的单例的时候，并不需要写 <code>dispatch_once</code> 来配合创建实例，那 Swift 的单例是如何保证线程安全的呢？请往下看。</p>
<h4 id="Swift单例模式的本质"><a href="#Swift单例模式的本质" class="headerlink" title="Swift单例模式的本质"></a>Swift单例模式的本质</h4><p>编译后的sil代码</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@_hasMissingDesignatedInitializers public <span class="keyword">class</span> <span class="title class_">SHNetworkManager</span> {</span><br><span class="line">    @_hasStorage @_hasInitialValue public <span class="keyword">static</span> <span class="keyword">let</span> <span class="attr">shared</span>: <span class="title class_">SHNetworkManager</span> { get }</span><br><span class="line">    private <span class="title function_">init</span>()</span><br><span class="line">    @objc deinit</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>getter实现</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// static SHNetworkManager.shared.getter</span></span><br><span class="line">sil [transparent] @$s14ViewController16SHNetworkManagerC6sharedACvgZ : $@<span class="title function_">convention</span>(method) (@thick <span class="title class_">SHNetworkManager</span>.<span class="property">Type</span>) -&gt; @owned <span class="title class_">SHNetworkManager</span> {</span><br><span class="line">    <span class="comment">// %0 "self"                                      // user: %1</span></span><br><span class="line">    <span class="title function_">bb0</span>(%<span class="number">0</span> : $@thick <span class="title class_">SHNetworkManager</span>.<span class="property">Type</span>):</span><br><span class="line">    debug_value %<span class="number">0</span> : $@thick <span class="title class_">SHNetworkManager</span>.<span class="property">Type</span>, <span class="keyword">let</span>, name <span class="string">"self"</span>, argno <span class="number">1</span> <span class="comment">// id: %1</span></span><br><span class="line">    <span class="comment">// function_ref SHNetworkManager.shared.unsafeMutableAddressor 看这里</span></span><br><span class="line">    %<span class="number">2</span> = function_ref @$s14ViewController16SHNetworkManagerC6sharedACvau : $@<span class="title function_">convention</span>(thin) () -&gt; <span class="title class_">Builtin</span>.<span class="property">RawPointer</span> <span class="comment">// user: %3</span></span><br><span class="line">    %<span class="number">3</span> = apply %<span class="number">2</span>() : $@<span class="title function_">convention</span>(thin) () -&gt; <span class="title class_">Builtin</span>.<span class="property">RawPointer</span> <span class="comment">// user: %4</span></span><br><span class="line">    %<span class="number">4</span> = pointer_to_address %<span class="number">3</span> : $Builtin.<span class="property">RawPointer</span> to [strict] $*<span class="title class_">SHNetworkManager</span> <span class="comment">// user: %5</span></span><br><span class="line">    %<span class="number">5</span> = load %<span class="number">4</span> : $*<span class="title class_">SHNetworkManager</span>               <span class="comment">// users: %7, %6</span></span><br><span class="line">    strong_retain %<span class="number">5</span> : $SHNetworkManager            <span class="comment">// id: %6</span></span><br><span class="line">    <span class="keyword">return</span> %<span class="number">5</span> : $SHNetworkManager                   <span class="comment">// id: %7</span></span><br><span class="line">} <span class="comment">// end sil function '$s14ViewController16SHNetworkManagerC6sharedACvgZ'</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>在 getter 中，调用了一个&nbsp;<code>unsafeMutableAddressor</code>&nbsp;方法，<code>unsafeMutableAddressor</code>&nbsp;的实现如下：</p>
<figure class="highlight plaintext"><figcaption><span>SHNetworkManager.shared.unsafeMutableAddressor</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">sil [global_init] @$s14ViewController16SHNetworkManagerC6sharedACvau : $@convention(thin) () -&gt; Builtin.RawPointer {</span><br><span class="line">bb0:</span><br><span class="line">%0 = global_addr @$s14ViewController16SHNetworkManagerC6shared_Wz : $*Builtin.Word // user: %1</span><br><span class="line">%1 = address_to_pointer %0 : $*Builtin.Word to $Builtin.RawPointer // user: %3</span><br><span class="line">// function_ref one-time initialization function for shared</span><br><span class="line">//共享的一次性初始化函数</span><br><span class="line">%2 = function_ref @$s14ViewController16SHNetworkManagerC6shared_WZ : $@convention(c) () -&gt; () // user: %3</span><br><span class="line">**//看这里的once** </span><br><span class="line">%3 = builtin "once"(%1 : $Builtin.RawPointer, %2 : $@convention(c) () -&gt; ()) : $()</span><br><span class="line">%4 = global_addr @$s14ViewController16SHNetworkManagerC6sharedACvpZ : $*SHNetworkManager // user: %5</span><br><span class="line">%5 = address_to_pointer %4 : $*SHNetworkManager to $Builtin.RawPointer // user: %6</span><br><span class="line">return %5 : $Builtin.RawPointer                 // id: %6</span><br><span class="line">} // end sil function '$s14ViewController16SHNetworkManagerC6sharedACvau'</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>编译出ir代码，全局来查找once。</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">swiftc -emit-ir ${<span class="variable constant_">SRCROOT</span>}/<span class="title class_">LGSwiftTest</span>/main.<span class="property">swift</span> &gt; ./main.<span class="property">ll</span> &amp;&amp; open main.<span class="property">ll</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">define swiftcc i8* @<span class="string">"$s4main16SSNetWorkManagerC6sharedACvau"</span>() #<span class="number">0</span> {</span><br><span class="line"></span><br><span class="line"><span class="attr">entry</span>:</span><br><span class="line"></span><br><span class="line">&nbsp; %<span class="number">0</span> = load i64, i64* @<span class="string">"$s4main16SSNetWorkManagerC6shared_Wz"</span>, align <span class="number">8</span></span><br><span class="line"></span><br><span class="line">&nbsp; %<span class="number">1</span> = icmp eq i64 %<span class="number">0</span>, -<span class="number">1</span></span><br><span class="line"></span><br><span class="line">&nbsp; %<span class="number">2</span> = call i1 @llvm.<span class="property">expect</span>.<span class="title function_">i1</span>(i1 %<span class="number">1</span>, i1 <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">&nbsp; br i1 %<span class="number">2</span>, label %once_done, label %once_not_done</span><br><span class="line"></span><br><span class="line"><span class="attr">once_done</span>:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; preds = %once_not_done, %entry</span><br><span class="line"></span><br><span class="line">&nbsp; %<span class="number">3</span> = load i64, i64* @<span class="string">"$s4main16SSNetWorkManagerC6shared_Wz"</span>, align <span class="number">8</span></span><br><span class="line"></span><br><span class="line">&nbsp; %<span class="number">4</span> = icmp eq i64 %<span class="number">3</span>, -<span class="number">1</span></span><br><span class="line"></span><br><span class="line">&nbsp; call <span class="keyword">void</span> @llvm.<span class="title function_">assume</span>(i1 %<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">&nbsp; ret i8* bitcast (%T4main16SSNetWorkManagerC** @<span class="string">"$s4main16SSNetWorkManagerC6sharedACvpZ"</span> to i8*)</span><br><span class="line"></span><br><span class="line"><span class="attr">once_not_done</span>:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; preds = %entry</span><br><span class="line"></span><br><span class="line">&nbsp; call <span class="keyword">void</span> @<span class="title function_">swift_once</span>(i64* @<span class="string">"$s4main16SSNetWorkManagerC6shared_Wz"</span>, i8* bitcast (<span class="keyword">void</span> ()* @<span class="string">"$s4main16SSNetWorkManagerC6shared_WZ"</span> to i8*), i8* undef)</span><br><span class="line"></span><br><span class="line">&nbsp; br label %once_done</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>混写过后的方法<code>s14ViewController16SHNetworkManagerC6sharedACvau</code>，在sil代码中是<code>SHNetworkManager.shared.unsafeMutableAddressor</code>，下面有once_not_done，里面有swift_once，<br>猜测它是一个swift内部的一个函数，在swift源码中搜索，在源码中<strong>Once.cpp</strong>中</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">/// Runs the given function with the given context argument exactly once.</span><br><span class="line">/// The predicate argument must point to a global or static variable of static</span><br><span class="line">/// extent of type swift_once_t.</span><br><span class="line">void swift::swift_once(swift_once_t *predicate, void (*fn)(void *),</span><br><span class="line">                       void *context) {</span><br><span class="line">#ifdef SWIFT_STDLIB_SINGLE_THREADED_RUNTIME</span><br><span class="line">  if (! *predicate) {</span><br><span class="line">    *predicate = true;</span><br><span class="line">    fn(context);</span><br><span class="line">  }</span><br><span class="line">#elif defined(__APPLE__)</span><br><span class="line">  dispatch_once_f(predicate, context, fn);</span><br><span class="line">#elif defined(__CYGWIN__)</span><br><span class="line">  _swift_once_f(predicate, context, fn);</span><br><span class="line">#else</span><br><span class="line">  std::call_once(*predicate, [fn, context]() { fn(context); });</span><br><span class="line">#endif</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>如果等于 <code>__APPLE__</code>，会调用 <code>dispatch_once_f</code> 函数，就是 iOS 中 <strong>GCD</strong> 的函数。所以 Swift 中单例模式在底层中是和 OC 一样，都调用了 <strong>GCD</strong> 的函数。并且这个函数在执行一次后就不会在执行，以保证线程安全。</p>
<h1 id="属性在Mach-O中的位置"><a href="#属性在Mach-O中的位置" class="headerlink" title="属性在Mach-O中的位置"></a>属性在Mach-O中的位置</h1><p>类的方法是存放在VTable中。<br>Swift类的本质是一个HeapObject的结构体指针，在HeapObject中有一个metadata，metadata中有一个Description成员变量，Description是名为TargeClassDescription的类，在TargetDescription中有一个VTable存储Swift类中的方法。<br>那么Swift中类的属性又放在哪里呢，我们来看一个TatgetClassDescription的结构：它继承了两个类，这是抽出来的</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TargetClassDescriptor</span> {</span><br><span class="line">    <span class="keyword">var</span> <span class="attr">flags</span>: <span class="title class_">UInt32</span> <span class="number">4</span>字节</span><br><span class="line">    <span class="keyword">var</span> <span class="attr">parent</span>: <span class="title class_">UInt32</span></span><br><span class="line">    <span class="keyword">var</span> <span class="attr">name</span>: <span class="title class_">Int32</span></span><br><span class="line">    <span class="keyword">var</span> <span class="attr">accessFunctionPointer</span>: <span class="title class_">Int32</span></span><br><span class="line">    <span class="keyword">var</span> <span class="attr">fieldDescriptor</span>: <span class="title class_">Int32</span></span><br><span class="line">    <span class="keyword">var</span> <span class="attr">superClassType</span>: <span class="title class_">Int32</span></span><br><span class="line">    <span class="keyword">var</span> <span class="attr">metadataNegativeSizeInWords</span>: <span class="title class_">UInt32</span></span><br><span class="line">    <span class="keyword">var</span> <span class="attr">metadataPositiveSizeInWords</span>: <span class="title class_">UInt32</span></span><br><span class="line">    <span class="keyword">var</span> <span class="attr">numImmediateMembers</span>: <span class="title class_">UInt32</span></span><br><span class="line">    <span class="keyword">var</span> <span class="attr">numFields</span>: <span class="title class_">UInt32</span></span><br><span class="line">    <span class="keyword">var</span> <span class="attr">fieldOffsetVectorOffset</span>: <span class="title class_">UInt32</span></span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Offset</span>: <span class="title class_">UInt32</span></span><br><span class="line">    <span class="comment">// var size: UInt32</span></span><br><span class="line">    <span class="comment">//V-Table</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>SWift类的属性存放在fieldDescription中的，其源码定义在Metadata.h中的TargetTypeContextDescription类中，注意：<strong>TatgetClassDescription</strong>继承自<strong>TargetTypeContextDescriptor</strong>。<br>源码定义如下：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// A pointer to the field descriptor for the type, if any.</span></span><br><span class="line"><span class="title class_">TargetRelativeDirectPointer</span>&lt;<span class="title class_">Runtime</span>, <span class="keyword">const</span> <span class="attr">reflection</span>::<span class="title class_">FieldDescriptor</span>, <span class="comment">/*nullable*/</span> <span class="literal">true</span>&gt; <span class="title class_">Fields</span>;</span><br></pre></td></tr></tbody></table></figure>
<p>点进去看FieldDescription的结构大致如下：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Field descriptors contain a collection of field records for a single</span></span><br><span class="line"><span class="comment">// class, struct or enum declaration.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FieldDescriptor</span> {</span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">FieldRecord</span> *<span class="title function_">getFieldRecordBuffer</span>() <span class="keyword">const</span> {</span><br><span class="line">    <span class="keyword">return</span> reinterpret_cast&lt;<span class="keyword">const</span> <span class="title class_">FieldRecord</span> *&gt;(<span class="variable language_">this</span> + <span class="number">1</span>);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line"><span class="attr">public</span>:</span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">RelativeDirectPointer</span>&lt;<span class="keyword">const</span> char&gt; <span class="title class_">MangledTypeName</span>;</span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">RelativeDirectPointer</span>&lt;<span class="keyword">const</span> char&gt; <span class="title class_">Superclass</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title class_">FieldDescriptor</span>() = <span class="keyword">delete</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">FieldDescriptorKind</span> <span class="title class_">Kind</span>;</span><br><span class="line">  <span class="keyword">const</span> uint16_t <span class="title class_">FieldRecordSize</span>;</span><br><span class="line">  <span class="keyword">const</span> uint32_t <span class="title class_">NumFields</span>;</span><br><span class="line">  </span><br><span class="line">  using const_iterator = <span class="title class_">FieldRecordIterator</span>;</span><br></pre></td></tr></tbody></table></figure>
<p>整理出来，FieldDescriptor的结构体大致如下：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">FieldDescriptor</span>{</span><br><span class="line">    <span class="title class_">MangledTypeName</span> int32</span><br><span class="line">    <span class="title class_">Superclass</span> int32</span><br><span class="line">    <span class="title class_">Kind</span> uint16</span><br><span class="line">    <span class="title class_">FieldRecordSize</span> uint16</span><br><span class="line">    <span class="title class_">NumFields</span> int32</span><br><span class="line">    <span class="comment">//这个没有体现出来 便于理解写在下面 源码里是这个</span></span><br><span class="line">    <span class="comment">//using const_iterator = FieldRecordIterator;</span></span><br><span class="line">    <span class="title class_">FieldRecords</span> 【<span class="title class_">FiedlRecord</span>】</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>在FieldDescriptor中有这么几个方法：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">const_iterator <span class="title function_">begin</span>() <span class="keyword">const</span> {</span><br><span class="line">   auto <span class="title class_">Begin</span> = <span class="title function_">getFieldRecordBuffer</span>();</span><br><span class="line">   auto <span class="title class_">End</span> = <span class="title class_">Begin</span> + <span class="title class_">NumFields</span>;</span><br><span class="line">   <span class="keyword">return</span> const_iterator { <span class="title class_">Begin</span>, <span class="title class_">End</span> };</span><br><span class="line"> }</span><br><span class="line"></span><br><span class="line"> const_iterator <span class="title function_">end</span>() <span class="keyword">const</span> {</span><br><span class="line">   auto <span class="title class_">Begin</span> = <span class="title function_">getFieldRecordBuffer</span>();</span><br><span class="line">   auto <span class="title class_">End</span> = <span class="title class_">Begin</span> + <span class="title class_">NumFields</span>;</span><br><span class="line">   <span class="keyword">return</span> const_iterator { <span class="title class_">End</span>, <span class="title class_">End</span> };</span><br><span class="line"> }</span><br><span class="line"></span><br><span class="line"> <span class="attr">llvm</span>::<span class="title class_">ArrayRef</span>&lt;<span class="title class_">FieldRecord</span>&gt; <span class="title function_">getFields</span>() <span class="keyword">const</span> {</span><br><span class="line">   <span class="keyword">return</span> {<span class="title function_">getFieldRecordBuffer</span>(), <span class="title class_">NumFields</span>};</span><br><span class="line"> }</span><br></pre></td></tr></tbody></table></figure>
<p>从这三个方法可以看出这个是迭代器，const_iterator是FieldRecordIterator，其源码结构如下：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">struct <span class="title class_">FieldRecordIterator</span> {</span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">FieldRecord</span> *<span class="title class_">Cur</span>;</span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">FieldRecord</span> * <span class="keyword">const</span> <span class="title class_">End</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title class_">FieldRecordIterator</span>(<span class="keyword">const</span> <span class="title class_">FieldRecord</span> *<span class="title class_">Cur</span>, <span class="keyword">const</span> <span class="title class_">FieldRecord</span> * <span class="keyword">const</span> <span class="title class_">End</span>)</span><br><span class="line">    : <span class="title class_">Cur</span>(<span class="title class_">Cur</span>), <span class="title class_">End</span>(<span class="title class_">End</span>) {}</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">FieldRecord</span> &amp;operator*() <span class="keyword">const</span> {</span><br><span class="line">    <span class="keyword">return</span> *<span class="title class_">Cur</span>;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">FieldRecord</span> *operator-&gt;() <span class="keyword">const</span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Cur</span>;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="title class_">FieldRecordIterator</span> &amp;operator++() {</span><br><span class="line">    ++<span class="title class_">Cur</span>;</span><br><span class="line">    <span class="keyword">return</span> *<span class="variable language_">this</span>;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  bool operator==(<span class="keyword">const</span> <span class="title class_">FieldRecordIterator</span> &amp;other) <span class="keyword">const</span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Cur</span> == other.<span class="property">Cur</span> &amp;&amp; <span class="title class_">End</span> == other.<span class="property">End</span>;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  bool operator!=(<span class="keyword">const</span> <span class="title class_">FieldRecordIterator</span> &amp;other) <span class="keyword">const</span> {</span><br><span class="line">    <span class="keyword">return</span> !(*<span class="variable language_">this</span> == other);</span><br><span class="line">  }</span><br><span class="line">};</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>成员变量为FieldRecord，我们来看一下它在源码的结构：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">FieldRecord</span> {</span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">FieldRecordFlags</span> <span class="title class_">Flags</span>;</span><br><span class="line"></span><br><span class="line"><span class="attr">public</span>:</span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">RelativeDirectPointer</span>&lt;<span class="keyword">const</span> char&gt; <span class="title class_">MangledTypeName</span>;</span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">RelativeDirectPointer</span>&lt;<span class="keyword">const</span> char&gt; <span class="title class_">FieldName</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title class_">FieldRecord</span>() = <span class="keyword">delete</span>;</span><br><span class="line"></span><br><span class="line">  bool <span class="title function_">hasMangledTypeName</span>() <span class="keyword">const</span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">MangledTypeName</span>;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="title class_">StringRef</span> <span class="title function_">getMangledTypeName</span>() <span class="keyword">const</span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Demangle</span>::<span class="title function_">makeSymbolicMangledNameStringRef</span>(<span class="title class_">MangledTypeName</span>.<span class="title function_">get</span>());</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="title class_">StringRef</span> <span class="title function_">getFieldName</span>() <span class="keyword">const</span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">FieldName</span>.<span class="title function_">get</span>();</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  bool <span class="title function_">isIndirectCase</span>() <span class="keyword">const</span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Flags</span>.<span class="title function_">isIndirectCase</span>();</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  bool <span class="title function_">isVar</span>() <span class="keyword">const</span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Flags</span>.<span class="title function_">isVar</span>();</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>他有三个成员变量：Flags,MangledTypeName,FieldName.Flags不用管，MangledTypeName为它的类型信息，FieldName是它的属性的名称信息。<br>到这里，我们基本可以确定属性存储在底层源码的结构以及位置，我们的查找流程如下：</p>
<ul>
<li>找到<strong>HeapObject</strong>。</li>
<li>从<strong>HeapObject</strong>中找到<strong>HeapMetaData</strong>。</li>
<li>继续跟进，<strong>HeapMetadata</strong>为 <strong>TargetHeapMetadata</strong>的别名</li>
<li>找到<strong>TargetHeapMetadata</strong>结构体，找到<strong>TargetClassDescriptor</strong>，然后找到<strong>TargetTypeContextDescriptor</strong>，并且找到了<strong>Fields</strong>成员变量。</li>
<li>通过Fields找到了<strong>FieldDescriptor</strong>的定义，并且找到其中的<strong>FieldRecords</strong>，</li>
<li>通过迭代器<strong>FieldRecodIterator</strong>，找到了<strong>FieldRecord</strong>。</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://ssj1314.github.io/2022/09/02/Swift%E7%AC%AC%E4%B8%80%E8%8A%82%E8%AF%BE%E7%B1%BB%E4%B8%8E%E7%BB%93%E6%9E%84%E4%BD%932/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="大福禄">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="葫芦小金刚">
      <meta itemprop="description" content="书中自有颜如玉">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 葫芦小金刚">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/09/02/Swift%E7%AC%AC%E4%B8%80%E8%8A%82%E8%AF%BE%E7%B1%BB%E4%B8%8E%E7%BB%93%E6%9E%84%E4%BD%932/" class="post-title-link" itemprop="url">Swift第一节课类与结构体2</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-09-02 09:03:44 / 修改时间：09:04:18" itemprop="dateCreated datePublished" datetime="2022-09-02T09:03:44+08:00">2022-09-02</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <hr>
<h2 id="highlight-a11y-dark"><a href="#highlight-a11y-dark" class="headerlink" title="highlight: a11y-dark"></a>highlight: a11y-dark</h2><h1 id="一、异变方法"><a href="#一、异变方法" class="headerlink" title="一、异变方法"></a>一、异变方法</h1><p>第一天我们了解到，Swift 中 class 和 struct 都能定义方法。但是有一点区别的是，默认情况下，值类型属性不能被自身的实例方法修改。</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span> {</span><br><span class="line"><span class="keyword">var</span> x <span class="operator">=</span> <span class="number">0.0</span>, y <span class="operator">=</span> <span class="number">0.0</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">moveBy</span>(<span class="params">x</span> <span class="params">deltaX</span>: <span class="type">Double</span>, <span class="params">y</span> <span class="params">deltaY</span>: <span class="type">Double</span>) {</span><br><span class="line"></span><br><span class="line"><span class="comment">//self</span></span><br><span class="line">x <span class="operator">+=</span> deltaX</span><br><span class="line">y <span class="operator">+=</span> deltaY</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>通过 SIL 来对比一下，不添加 mutating 访问和添加 mutating 两者有什么本质的区别</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span> {</span><br><span class="line"><span class="keyword">var</span> x <span class="operator">=</span> <span class="number">0.0</span>, y <span class="operator">=</span> <span class="number">0.0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">test</span>(){</span><br><span class="line"><span class="keyword">let</span> tmp <span class="operator">=</span> <span class="keyword">self</span>.x</span><br><span class="line">}</span><br><span class="line"><span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">moveBy</span>(<span class="params">x</span> <span class="params">deltaX</span>: <span class="type">Double</span>, <span class="params">y</span> <span class="params">deltaY</span>: <span class="type">Double</span>) { </span><br><span class="line">    x <span class="operator">+=</span> deltaX</span><br><span class="line">    y <span class="operator">+=</span> deltaY</span><br><span class="line">   }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>sil hidden [ossa] @$s4main5PointV4testyyF : $@convention(method) (Point) -&gt;<br>这是普通的<br>debug_value %0 : $Point, let, name “self”, argno 1 // id: %1</p>
<p>sil hidden [ossa] @$s4main5PointV6moveBy1x1yySd_SdtF : $@convention(method)<br>这是加了mutating的<br>@inout Point<br>加了mutating的关键字多了一个 @inout关键字</p>
</blockquote>
<p>SIL 文档的解释</p>
<p><code>An @inout parameter is indirect. The address must be of an initialized object.</code>（当前参数类型是间接的，传递的是已经初始化过的地址）</p>
<p>异变方法的本质：对于变异方法, 传入的 self 被标记为 inout 参数。无论在 mutating 方法内部发生什么，都会影响外部依赖类型的一切。其实就是告诉外面，你拿的是我的根or源头，可以直接操作我。</p>
<p><strong>输入输出参数</strong>：如果我们想函数能够修改一个形式参数的值，而且希望这些改变在函数结束之后依然生效，那么就需要将形式参数定义为 输入输出形式参数 。在形式参数定义开始的时候在前边添加一个 <code>inout</code>键字可以定义一个输入输出形式参数</p>
<h1 id="二、方法调度"><a href="#二、方法调度" class="headerlink" title="二、方法调度"></a>二、方法调度</h1><p>//oc里是objc_mgsend</p>
<p>我们先来看一下 Swift 中的方法调度</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LGTeacher</span>{ func <span class="title function_">teach</span>(<span class="params"></span>){</span><br><span class="line"></span><br><span class="line"><span class="title function_">print</span>(<span class="string">"teach"</span>) }</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> t = <span class="title class_">LGTeacher</span>() </span><br><span class="line">t.<span class="title function_">teach</span>()</span><br></pre></td></tr></tbody></table></figure>
<p>teach函数的调用过程：找到 Metadata ，确定函数地址（metadata + 偏移量）， 执行函数基于函数表的调度之前我们在第一节课讲到了 Metdata 的数据结构，那么 V-Table 是存放在什么地方那？</p>
<p>我们先来回顾一下当前的数据结构</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">struct <span class="title class_">Metadata</span>{</span><br><span class="line"><span class="keyword">var</span> <span class="attr">kind</span>: <span class="title class_">Int</span></span><br><span class="line"><span class="keyword">var</span> <span class="attr">superClass</span>: <span class="title class_">Any</span>.<span class="property">Type</span> <span class="keyword">var</span> <span class="attr">cacheData</span>: (<span class="title class_">Int</span>, <span class="title class_">Int</span>) <span class="keyword">var</span> <span class="attr">data</span>: <span class="title class_">Int</span></span><br><span class="line"><span class="keyword">var</span> <span class="attr">classFlags</span>: <span class="title class_">Int32</span></span><br><span class="line"><span class="keyword">var</span> <span class="attr">instanceAddressPoint</span>: <span class="title class_">UInt32</span></span><br><span class="line"><span class="keyword">var</span> <span class="attr">instanceSize</span>: <span class="title class_">UInt32</span></span><br><span class="line"><span class="keyword">var</span> <span class="attr">instanceAlignmentMask</span>: <span class="title class_">UInt16</span></span><br><span class="line"><span class="keyword">var</span> <span class="attr">reserved</span>: <span class="title class_">UInt16</span></span><br><span class="line"><span class="keyword">var</span> <span class="attr">classSize</span>: <span class="title class_">UInt32</span></span><br><span class="line"><span class="keyword">var</span> <span class="attr">classAddressPoint</span>: <span class="title class_">UInt32</span></span><br><span class="line"><span class="keyword">var</span> <span class="attr">typeDescriptor</span>: <span class="title class_">UnsafeMutableRawPointer</span> <span class="keyword">var</span> <span class="attr">iVarDestroyer</span>: <span class="title class_">UnsafeRawPointer</span></span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>这里我们有一个东西需要关注 <code>typeDescriptor</code> ，不管是 Class ， Struct , Enum 都有自己的 Descriptor ，就是对类的一个详细描述</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">struct <span class="title class_">TargetClassDescriptor</span>{ <span class="keyword">var</span> <span class="attr">flags</span>: <span class="title class_">UInt32</span></span><br><span class="line"><span class="keyword">var</span> <span class="attr">parent</span>: <span class="title class_">UInt32</span></span><br><span class="line"><span class="keyword">var</span> <span class="attr">name</span>: <span class="title class_">Int32</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="attr">accessFunctionPointer</span>: <span class="title class_">Int32</span></span><br><span class="line"><span class="keyword">var</span> <span class="attr">fieldDescriptor</span>: <span class="title class_">Int32</span></span><br><span class="line"><span class="keyword">var</span> <span class="attr">superClassType</span>: <span class="title class_">Int32</span></span><br><span class="line"><span class="keyword">var</span> <span class="attr">metadataNegativeSizeInWords</span>: <span class="title class_">UInt32</span> <span class="keyword">var</span> <span class="attr">metadataPositiveSizeInWords</span>: <span class="title class_">UInt32</span> <span class="keyword">var</span> <span class="attr">numImmediateMembers</span>: <span class="title class_">UInt32</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="attr">numFields</span>: <span class="title class_">UInt32</span></span><br><span class="line"><span class="keyword">var</span> <span class="attr">fieldOffsetVectorOffset</span>: <span class="title class_">UInt32</span> <span class="keyword">var</span> <span class="title class_">Offset</span>: <span class="title class_">UInt32</span></span><br><span class="line"><span class="keyword">var</span> <span class="attr">size</span>: <span class="title class_">UInt32</span></span><br><span class="line"><span class="comment">//V-Table</span></span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Mahco-Mach-O-其实是Mach-Object文件格式的缩写，是-mac-以及-iOS-上可执行文件的格式，-类似于-windows-上的-PE-格式-Portable-Executable-linux-上的-elf-格式-Executableand-Linking-Format-。常见的-o，-a-dylib-Framework，dyld-dsym。"><a href="#Mahco-Mach-O-其实是Mach-Object文件格式的缩写，是-mac-以及-iOS-上可执行文件的格式，-类似于-windows-上的-PE-格式-Portable-Executable-linux-上的-elf-格式-Executableand-Linking-Format-。常见的-o，-a-dylib-Framework，dyld-dsym。" class="headerlink" title="Mahco: Mach-O 其实是Mach Object文件格式的缩写，是 mac 以及 iOS 上可执行文件的格式， 类似于 windows 上的 PE 格式 (Portable Executable ), linux 上的 elf 格式 (Executableand Linking Format) 。常见的 .o，.a .dylib Framework，dyld .dsym。"></a><strong>Mahco</strong>: Mach-O 其实是Mach Object文件格式的缩写，是 mac 以及 iOS 上可执行文件的格式， 类似于 windows 上的 PE 格式 (Portable Executable ), linux 上的 elf 格式 (Executableand Linking Format) 。常见的 .o，.a .dylib Framework，dyld .dsym。</h3><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/55d2443580c04b64b80683d6a9a4cfb5~tplv-k3u1fbpfcp-watermark.image" alt="WeChat2f0d6f00f519c9d2bb4d574053fd6aa3.png"></p>
<p><strong>Mahoc文件格式：首先是文件头，表明该文件是 Mach-O 格式，指定目标架构，还有一些其他的文件属性信<br>息，文件头信息影响后续的文件结构安排 Load commands是一张包含很多内容的表。内容包括区域的位置、符号表、动态符号表等。</strong></p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">LC_SEGMENT_64</span> 将文件中（<span class="number">32</span>位或<span class="number">64</span>位）的段映射到进程地址空间中</span><br><span class="line"><span class="type">LC_DYLD_INFO_ONLY</span> 动态链接相关信息</span><br><span class="line"></span><br><span class="line"><span class="type">LC_SYMTAB</span> 符号地址</span><br><span class="line"></span><br><span class="line"><span class="type">LC_DYSYMTAB</span> 动态符号表地址</span><br><span class="line"></span><br><span class="line"><span class="type">LC_LOAD_DYLINKER</span> dyld加载</span><br><span class="line"></span><br><span class="line"><span class="type">LC_UUID</span> 文件的<span class="type">UUID</span></span><br><span class="line"></span><br><span class="line"><span class="type">LC_VERSION_MIN_MACOSX</span> 支持最低的操作系统版本</span><br><span class="line"></span><br><span class="line"><span class="type">LC_SOURCE_VERSION</span> 源代码版本</span><br><span class="line"></span><br><span class="line"><span class="type">LC_MAIN</span> 设置程序主线程的入口地址和栈大小</span><br><span class="line"></span><br><span class="line"><span class="type">LC_LOAD_DYLIB</span> 依赖库的路径，包含三方库</span><br><span class="line"></span><br><span class="line"><span class="type">LC_FUNCTION_STARTS</span> 函数起始地址表</span><br><span class="line"></span><br><span class="line"><span class="type">LC_CODE_SIGNATURE</span> 代码签名</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>Data 区主要就是负责代码和数据记录的。Mach-O 是以 Segment 这种结构来组织数据的，一个 Segment 可以包含 0 个或多个 Section。根据 Segment 是映射的哪一个 LoadCommand，Segment 中 section 就可以被解读为是是代码，常量或者一些其他的数据类型。在装载在内存中时，也是根据 Segment 做内存映射的。</li>
</ul>
<p><strong>方法调度方式总结：</strong></p>
<table>
<thead>
<tr>
<th>类型</th>
<th>调度方式</th>
<th>extension</th>
</tr>
</thead>
<tbody><tr>
<td>值类型</td>
<td>静态派发</td>
<td>静态派发</td>
</tr>
<tr>
<td>类类型</td>
<td>函数表派发</td>
<td>静态派发</td>
</tr>
<tr>
<td>NSobject子类</td>
<td>函数表派发</td>
<td>静态派发</td>
</tr>
</tbody></table>
<h1 id="三、影响函数派发方式"><a href="#三、影响函数派发方式" class="headerlink" title="三、影响函数派发方式"></a>三、影响函数派发方式</h1><ul>
<li><p>final： 添加了 final 关键字的函数无法被重写，使用静态派发，不会在 vtable 中出现，且 对 objc 运行时不可见。</p>
</li>
<li><p>dynamic: 函数均可添加 dynamic 关键字，为非objc类和值类型的函数赋予动态性，但派发方式还是函数表派发。</p>
</li>
<li><p>@objc： 该关键字可以将Swift函数暴露给Objc运行时，依旧是函数表派发。</p>
</li>
<li><p>@objc + dynamic： 消息派发的方式</p>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://ssj1314.github.io/2022/09/02/Swift%E7%AC%AC%E4%B8%80%E8%8A%82%E8%AF%BE%E7%B1%BB%E4%B8%8E%E7%BB%93%E6%9E%84%E4%BD%931/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="大福禄">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="葫芦小金刚">
      <meta itemprop="description" content="书中自有颜如玉">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 葫芦小金刚">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/09/02/Swift%E7%AC%AC%E4%B8%80%E8%8A%82%E8%AF%BE%E7%B1%BB%E4%B8%8E%E7%BB%93%E6%9E%84%E4%BD%931/" class="post-title-link" itemprop="url">Swift第一节课类与结构体1</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-09-02 08:53:26 / 修改时间：09:06:30" itemprop="dateCreated datePublished" datetime="2022-09-02T08:53:26+08:00">2022-09-02</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <hr>
<h2 id="highlight-a11y-dark"><a href="#highlight-a11y-dark" class="headerlink" title="highlight: a11y-dark"></a>highlight: a11y-dark</h2><h1 id="一、Swift中的类型"><a href="#一、Swift中的类型" class="headerlink" title="一、Swift中的类型"></a>一、Swift中的类型</h1><p>Swfit中重要的两种类型 ：<strong>类类型</strong> 、<strong>结构体类型</strong></p>
<p>结构体和类相同点：</p>
<ol>
<li>定义存储值的属性</li>
<li>定义方法</li>
<li>定义下标及下标语法提供对其值的访问</li>
<li>定义初始化器</li>
<li>使用extension来拓展功能</li>
<li>遵循协议来提供某种功能<br>结构体和类不同点：</li>
<li>类有继承的特性，而结构体没有</li>
<li>类型转换使我们能在运行时检查和解释实例的类型</li>
<li>类有析构函数来释放其分配的资源</li>
<li>引用计数允许一个类实例有多个引用<br>5，类是引用类型，结构体是值类型，引用类型就相当于在线的 Excel ，当我们把这个链接共享给别人的时候，别人的修改我们 是能够看到的;值类型就相当于本地的 Excel ,当我们把本地的 Excel 传递给别人的时候，就 相当于重新复制了一份给别人，至于他们对于内容的修改我们是无法感知的。</li>
</ol>
<p>6.引用类型和值类型还有一个最直观的区别就是存储的位置不同:一般情况，值类型存储的在<br> 栈上，引用类型存储在堆上。</p>
<h1 id="Tips：内存区域"><a href="#Tips：内存区域" class="headerlink" title="Tips：内存区域"></a>Tips：内存区域</h1><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/21b647805389408e839f7c58a717a733~tplv-k3u1fbpfcp-watermark.image" alt="WeChata9d08c0e3940ed090c00fbc6a5b6938f.png"><br>栈区（<code>stack</code>）：局部变量和函数运行过程中的上下文</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">test</span>(){<span class="comment">//test就是个函数</span></span><br><span class="line"><span class="comment">//在函数内部声明的age变量就是一个局部变量</span></span><br><span class="line">    <span class="keyword">var</span> age : <span class="type">Int</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    <span class="built_in">print</span>(age)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>堆区（<code>Heap</code>）：存储所有对象;</p>
<p><code>Global</code> ：存储全局变量，常量，代码区;</p>
<p><code>Segment&amp;Section</code>:Mach-O文件有多个段（Segment），每个段都有不同的功能。每个段又分为很多小的<code>Section</code></p>
<ul>
<li>TEXT.text    : 机器码</li>
<li>TEXT.cstring : 硬编码的字符串</li>
<li>TEXT.const   : 初始化过的常量</li>
<li>DATA.data    : 初始化过的可变（静态/全局）数据</li>
<li>DATA.const   : 没有初始化的常量</li>
<li>DATA.bss     : 没有初始化的（静态/全局）变量</li>
<li>DATA.common  : 没有初始化的符号声明</li>
</ul>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/09ef978df92148418b3d1608ed016c88~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p>
<h3 id="1-结构体-struct"><a href="#1-结构体-struct" class="headerlink" title="1. 结构体 struct"></a>1. 结构体 struct</h3><ol>
<li>定义一个结构体</li>
</ol>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">LGSSJTeacher</span>{</span><br><span class="line">    <span class="keyword">var</span> age : <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="comment">//struct可以不写初始化器</span></span><br><span class="line"><span class="comment">//    init(age: Int,name: String) {</span></span><br><span class="line"><span class="comment">//        self.age = age</span></span><br><span class="line"><span class="comment">//        self.name = name</span></span><br><span class="line"><span class="comment">//    }</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> t <span class="operator">=</span> <span class="type">LGSSJTeacher</span>(age: <span class="number">10</span>, name: <span class="string">"乔帮主"</span>)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>结构体会默认生成一个初始化器，一旦在定义结构体时自定义初始化器，就不会默认生成其他初始化器。<br>对结构体进行初始化的时候，必须保证结构体的成员都有值，当我们给一个结构体的成员变量设置初始值的时候，可以不用在调用初始化器的时候传参数给有值的变量。</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">SJPerson</span> {</span><br><span class="line">    <span class="keyword">var</span> age: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> weight: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> sex: <span class="type">Bool</span></span><br><span class="line">}</span><br><span class="line"><span class="built_in">print</span>(<span class="type">MemoryLayout</span>&lt;<span class="type">SJPerson</span>&gt;.size)         <span class="comment">// 17</span></span><br><span class="line"><span class="built_in">print</span>(<span class="type">MemoryLayout</span>&lt;<span class="type">SJPerson</span>&gt;.stride)       <span class="comment">// 24</span></span><br><span class="line"><span class="built_in">print</span>(<span class="type">MemoryLayout</span>&lt;<span class="type">SJPerson</span>&gt;.alignment)    <span class="comment">// 8</span></span><br></pre></td></tr></tbody></table></figure>
<p>打印其内存和对齐的字节数，在64位系统下，Int占8个字节，bool占一个字节，8+8+1=17，但因为内存对齐原则，系统会分配24字节来存储SJPerson</p>
<h3 id="2、类-class"><a href="#2、类-class" class="headerlink" title="2、类 class"></a>2、类 class</h3><figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LGSSJTeacher</span>{</span><br><span class="line">    <span class="keyword">var</span> age : <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="comment">//struct可以不写初始化器</span></span><br><span class="line">    <span class="comment">//class 必须指定初始化器，当类成员没有初始值时</span></span><br><span class="line">    <span class="keyword">init</span>(<span class="params">age</span>: <span class="type">Int</span>,<span class="params">name</span>: <span class="type">String</span>) {</span><br><span class="line">        <span class="keyword">self</span>.age <span class="operator">=</span> age</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> t <span class="operator">=</span> <span class="type">LGSSJTeacher</span>(age: <span class="number">10</span>, name: <span class="string">"乔峰"</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>类是引用类型，意味着一个类类型的变量并不直接存储具体的实例对象，是对当前存储实例内存地址的引用，可以看出t和t1指向地址一致，本身不存储，自身的地址不一致</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">#####t和t1 指向的地址一样</span><br><span class="line"><span class="operator">**</span>(lldb) p t<span class="operator">**</span></span><br><span class="line"></span><br><span class="line">(<span class="type">LGSwiftTest</span>.<span class="type">LGSSJTeacher</span>) <span class="variable">$R0</span> <span class="operator">=</span> <span class="number">0x0000000100576cc0</span> (age <span class="operator">=</span> <span class="number">20</span>, name <span class="operator">=</span> <span class="string">"ssj"</span>)</span><br><span class="line"></span><br><span class="line"><span class="operator">**</span>(lldb) p t1<span class="operator">**</span></span><br><span class="line"></span><br><span class="line">(<span class="type">LGSwiftTest</span>.<span class="type">LGSSJTeacher</span>) <span class="variable">$R1</span> <span class="operator">=</span> <span class="number">0x0000000100576cc0</span> (age <span class="operator">=</span> <span class="number">20</span>, name <span class="operator">=</span> <span class="string">"ssj"</span>)</span><br><span class="line"></span><br><span class="line"><span class="operator">**</span>(lldb) x<span class="operator">/</span>8g <span class="number">0x0000000100576cc0</span><span class="operator">**</span></span><br><span class="line"></span><br><span class="line"><span class="number">0x100576cc0</span>: <span class="number">0x0000000100008180</span> <span class="number">0x0000000600000003</span></span><br><span class="line"></span><br><span class="line"><span class="number">0x100576cd0</span>: <span class="number">0x0000000000000014</span> <span class="number">0x00000000006a7373</span></span><br><span class="line"></span><br><span class="line"><span class="number">0x100576ce0</span>: <span class="number">0xe300000000000000</span> <span class="number">0x0000000000000000</span></span><br><span class="line"></span><br><span class="line"><span class="number">0x100576cf0</span>: <span class="number">0x0000000000000050</span> <span class="number">0x00000001c5c4c000</span></span><br><span class="line">######t和t1 的地址不一样 两者相差<span class="number">8</span>个字节</span><br><span class="line"></span><br><span class="line"><span class="operator">**</span>(lldb) po <span class="built_in">withUnsafePointer</span>(to: <span class="operator">&amp;</span>t1){<span class="built_in">print</span>(<span class="variable">$0</span>)}<span class="operator">**</span></span><br><span class="line"></span><br><span class="line"><span class="operator">**</span><span class="number">0x0000000100008220</span><span class="operator">**</span></span><br><span class="line"></span><br><span class="line"><span class="number">0</span> elements</span><br><span class="line"></span><br><span class="line"><span class="operator">****</span>\</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="operator">**</span>(lldb) po <span class="built_in">withUnsafePointer</span>(to: <span class="operator">&amp;</span>t){<span class="built_in">print</span>(<span class="variable">$0</span>)}<span class="operator">**</span></span><br><span class="line"></span><br><span class="line"><span class="operator">**</span><span class="number">0x0000000100008218</span><span class="operator">**</span></span><br><span class="line"></span><br><span class="line"><span class="number">0</span> elements</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h2 id="对象的堆空间申请过程"><a href="#对象的堆空间申请过程" class="headerlink" title="对象的堆空间申请过程"></a>对象的堆空间申请过程</h2><p>在Swift中，创建类对象需要向堆空间申请内存，大概流程如下</p>
<ol>
<li>class._allocating_init()</li>
<li>libswiftCore.dylib:swift_allocObject</li>
<li>libswiftCore.dylib:swift_slowAlloc</li>
<li>libsystem_malloc.dylib:malloc<br>在Mac。iOS中的 <code>malloc</code>函数分配的内存大小总是16的倍数。</li>
</ol>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LGPonit</span>{</span><br><span class="line">    <span class="keyword">var</span> x <span class="operator">=</span> <span class="number">16</span></span><br><span class="line">    <span class="keyword">var</span> y <span class="operator">=</span> <span class="number">18</span></span><br><span class="line">    <span class="keyword">var</span> test <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p <span class="operator">=</span> <span class="type">LGPonit</span>()</span><br><span class="line"><span class="comment">//class_getInstanceSize ： 返回类的实例大小</span></span><br><span class="line"><span class="built_in">print</span>(class_getInstanceSize(<span class="type">LGPonit</span>.<span class="keyword">self</span>))</span><br><span class="line"><span class="comment">//malloc_size 系统分配的内存大小</span></span><br><span class="line"><span class="built_in">print</span>(malloc_size(<span class="built_in">unsafeBitCast</span>(p, to: <span class="type">UnsafeRawPointer</span>.<span class="keyword">self</span>)))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"end"</span>)</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>可以看到，类大小40字节，系统分配48字节</li>
<li>在类中 x是int占8个字节，y也是8个字节，test占一个（bool值），17个字节，但是类存储在堆空间中，前面需要8个字节存储类型信息，8个字节存储引用计数，33个字节，根据内存对齐（8字节对齐（4x8=32&lt;33,需要再分配一个8字节凑数）），所以5*8=40字节。</li>
<li>因为上面所说，<code>malloc</code>函数分配的内存大小时16的倍数，所以最终系统分配了48字节给LGPoint。</li>
</ul>
<h2 id="类的初始化器"><a href="#类的初始化器" class="headerlink" title="类的初始化器"></a>类的初始化器</h2><p>1.指定初始化器 看上面的</p>
<p>2.可失败初始化器</p>
<p>当初始值不满足某个条件时，需要给初始化方法返回一个nil，可以在init后面接一个可选项？来修饰</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SPerson</span> {</span><br><span class="line">    <span class="keyword">var</span> age: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init?</span>(<span class="params">age</span>: <span class="type">Int</span>, <span class="params">name</span>: <span class="type">String</span>) {</span><br><span class="line">        <span class="keyword">if</span> age <span class="operator">&lt;</span> <span class="number">18</span> { <span class="keyword">return</span> <span class="literal">nil</span>}</span><br><span class="line">        <span class="keyword">self</span>.age <span class="operator">=</span> age</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> p1 <span class="operator">=</span> <span class="type">SPerson</span>(age: <span class="number">16</span>, name: <span class="string">"乔峰"</span>)</span><br><span class="line"><span class="keyword">let</span> p2 <span class="operator">=</span> <span class="type">SPerson</span>(age: <span class="number">18</span>, name: <span class="string">"虚竹"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"p1 - <span class="subst">\(String(describing: p1))</span>"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"p2 - <span class="subst">\(String(describing: p2))</span>"</span>)</span><br><span class="line"></span><br><span class="line">打印结果：</span><br><span class="line">p1 <span class="operator">-</span> <span class="literal">nil</span></span><br><span class="line">p2 <span class="operator">-</span> <span class="type">Optional</span>(_1_结构体与类.<span class="type">SPerson</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>3.必要初始化器</p>
<p>当初始化器器需要在init前面使用required修饰</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SPerson</span> {</span><br><span class="line">    <span class="keyword">var</span> age: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="comment">// 父类定义必要实现初始化器</span></span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>(<span class="params">age</span>: <span class="type">Int</span>, <span class="params">name</span>: <span class="type">String</span>) {</span><br><span class="line">        <span class="keyword">self</span>.age <span class="operator">=</span> age</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SStudent</span>: <span class="title class_">SPerson</span> {</span><br><span class="line">    <span class="keyword">var</span> height: <span class="type">Int</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="params">height</span>: <span class="type">Int</span>) {</span><br><span class="line">    <span class="keyword">self</span>.height <span class="operator">=</span> height</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(age: <span class="number">18</span>, name: <span class="string">"乔峰"</span>)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 子类必须实现父类的必要初始化器</span></span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>(<span class="params">age</span>: <span class="type">Int</span>, <span class="params">name</span>: <span class="type">String</span>) {</span><br><span class="line">        <span class="built_in">fatalError</span>(<span class="string">"init(age:name:) has not been implemented"</span>)</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>4.便捷初始化器</p>
<p>为么可以为类提供一个便捷初始化器，需要在init前用convenience修饰</p>
<p>如代码所示 便捷初始化器必须从相同的类里面调用另一个初始化器，并且最终必须调用一个指定初始化器</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SPerson</span> {</span><br><span class="line">    <span class="keyword">var</span> age: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="params">age</span>: <span class="type">Int</span>, <span class="params">name</span>: <span class="type">String</span>) {</span><br><span class="line">        <span class="keyword">self</span>.age <span class="operator">=</span> age</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">convenience</span> <span class="keyword">init</span>() {</span><br><span class="line">        <span class="keyword">self</span>.<span class="keyword">init</span>(age: <span class="number">18</span>, name: <span class="string">"乔峰"</span>)</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h1 id="二、Swift中编译流程"><a href="#二、Swift中编译流程" class="headerlink" title="二、Swift中编译流程"></a>二、Swift中编译流程</h1><h2 id="1-swift代码编译流程"><a href="#1-swift代码编译流程" class="headerlink" title="1.swift代码编译流程"></a>1.swift代码编译流程</h2><p> iOS不管是OC还是Swift，都是通过LLVM进行编译的，OC通clang编译器，编译成IR，然后再生成可执行文件.o(机器码)，swift则是通过Swift编译器编译出IR，然后再生成可执行文件.o<br><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f8c1385531404205a83562359f6a3e2f~tplv-k3u1fbpfcp-watermark.image" alt="WeChat786fb5f947ff1b9f3dadf7f38d9d6477.png"></p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/87defffca10340599e195425be0bd72a~tplv-k3u1fbpfcp-watermark.image" alt="WeChat32c482bd2a20e5b8f93d803441b9b383.png"></p>
<ul>
<li>首先<code>swift Code</code> 经过 <code>-dump-parse</code> 进行语义分析解析成 <code>Parse</code>（抽象语法树）</li>
<li><code>parse</code>经过-dump-ast 进行语义分析语法是否正确，是否安全</li>
<li><code>sema</code> 之后会把 swift-code 降级变成<code>SILGen</code>（swift中间代码），对于SILGen又分为Raw SIL和经过优化的SIL opt Canonical SIL。</li>
<li>优化完成的<code>SIL</code> 会由LLVM降级成为IR，降级之后由后端代码编译成机器码</li>
</ul>
<h3 id="编译命令"><a href="#编译命令" class="headerlink" title="编译命令"></a>编译命令</h3><figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 分析输出AST</span></span><br><span class="line">swiftc main.swift <span class="operator">-</span>dump<span class="operator">-</span>parse</span><br><span class="line"></span><br><span class="line"><span class="comment">// 分析并且检查类型输出AST</span></span><br><span class="line">swiftc main.swift <span class="operator">-</span>dump<span class="operator">-</span>ast</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成中间体语言（SIL），未优化</span></span><br><span class="line">swiftc main.swift <span class="operator">-</span>emit<span class="operator">-</span>silgen</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成中间体语言（SIL），优化后的</span></span><br><span class="line">swiftc main.swift <span class="operator">-</span>emit<span class="operator">-</span>sil</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成LLVM中间体语言 （.ll文件）</span></span><br><span class="line">swiftc main.swift <span class="operator">-</span>emit<span class="operator">-</span>ir</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成LLVM中间体语言 （.bc文件）</span></span><br><span class="line">swiftc main.swift <span class="operator">-</span>emit<span class="operator">-</span>bc</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成汇编</span></span><br><span class="line">swiftc main.swift <span class="operator">-</span>emit<span class="operator">-</span>assembly</span><br><span class="line"></span><br><span class="line"><span class="comment">// 编译生成可执行.out文件</span></span><br><span class="line">swiftc <span class="operator">-</span>o main.o main.swift</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h3 id="将代码编译成-sil-代码"><a href="#将代码编译成-sil-代码" class="headerlink" title="将代码编译成 sil 代码"></a>将代码编译成 sil 代码</h3><figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LGPonit</span>{</span><br><span class="line">    <span class="keyword">var</span> x <span class="operator">=</span> <span class="number">16</span></span><br><span class="line">    <span class="keyword">var</span> y <span class="operator">=</span> <span class="number">18</span></span><br><span class="line">    <span class="keyword">var</span> test <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p <span class="operator">=</span> <span class="type">LGPonit</span>()</span><br></pre></td></tr></tbody></table></figure>
<p>终端 cd 到项目的 main.swift 目录，输入&nbsp;<code>swiftc main.swift -emit-sil</code>&nbsp;并按回车键，会在生成一个 main.sil 文件，并且会在终端输出 SIL 代码。 SIL 代码如下：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bf393a7324b74b2595f7c5981c2df45a~tplv-k3u1fbpfcp-watermark.image" alt="WeChat3a52e986915c40fa8621a51ce0ac2619.png"><br>关于 SIL 的语法说明，其实也有相应的文档。这里贴上文档说明的地址：<a href="https://link.juejin.cn/?target=https://github.com/apple/swift/blob/main/docs/SIL.rst%23sil-stage" title="https://github.com/apple/swift/blob/main/docs/SIL.rst#sil-stage">SIL参考文档</a></p>
<h3 id="汇编探索初始化流程"><a href="#汇编探索初始化流程" class="headerlink" title="汇编探索初始化流程"></a>汇编探索初始化流程</h3><p>通过汇编查看，SPerson 在进行初始化的时候，在底层会调用&nbsp;<code>__allocating_init</code>&nbsp;的函数，那么&nbsp;<code>__allocating_init</code>&nbsp;做了什么事情呢，跟进去看一下。</p>
<p>让断点走到&nbsp;<code>__allocating_init</code>&nbsp;这一行代码，按住 control 键，点击这个向下的按钮。<br>可以看到，进入到 <code>__allocating_init</code> 的内部实现后，发现它会调用一个 <code>swift_allocObject</code> 函数，那么在继续跟汇编的时候跟丢了。</p>
<p>接下来我们来看一下源码。源码可以去苹果官网下-<a href="https://link.juejin.cn/?target=https://github.com/apple/swift" title="https://github.com/apple/swift">swift源码下载地址</a>。用 VSCode 打开下载好的 swift 源码，全局搜索 <code>swift_allocObject</code> 这个函数。</p>
<p>在 <code>HeapObject.cpp</code> 文件中找到 <code>swift_allocObject</code> 函数的实现，并且在 <code>swift_allocObject</code> 函数的实现上方，有一个 <code>_swift_allocObject_</code> 函数的实现。</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第一个参数，元数据。</span></span><br><span class="line"><span class="comment">// 第二个参数，分配内存的大小</span></span><br><span class="line"><span class="comment">// 第三个参数，内存对齐，值一般为 7，因为遵守8字节对齐</span></span><br><span class="line"><span class="keyword">static</span> <span class="type">HeapObject</span> <span class="operator">*</span>_swift_allocObject_(<span class="type">HeapMetadata</span> const <span class="operator">*</span>metadata,</span><br><span class="line">                                    size_t requiredSize,</span><br><span class="line">                                    size_t requiredAlignmentMask) {</span><br><span class="line"><span class="built_in">assert</span>(isAlignmentMask(requiredAlignmentMask));</span><br><span class="line">auto object <span class="operator">=</span> reinterpret_cast<span class="operator">&lt;</span><span class="type">HeapObject</span> <span class="operator">*&gt;</span>(</span><br><span class="line">   swift_slowAlloc(requiredSize, requiredAlignmentMask));</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">NOTE:</span> this relies on the C++17 guaranteed semantics of no null-pointer</span></span><br><span class="line"><span class="comment">// check on the placement new allocator which we have observed on Windows,</span></span><br><span class="line"><span class="comment">// Linux, and macOS.</span></span><br><span class="line">new (object) <span class="type">HeapObject</span>(metadata);</span><br><span class="line"></span><br><span class="line"><span class="comment">// If leak tracking is enabled, start tracking this object.</span></span><br><span class="line"><span class="type">SWIFT_LEAKS_START_TRACKING_OBJECT</span>(object);</span><br><span class="line"></span><br><span class="line"><span class="type">SWIFT_RT_TRACK_INVOCATION</span>(object, swift_allocObject);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> object;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>在函数的内部会调用一个&nbsp;<code>swift_slowAlloc</code>&nbsp;函数，我们来看下&nbsp;<code>swift_slowAlloc</code>&nbsp;函数的内部实现：</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">void <span class="operator">*</span>swift::swift_slowAlloc(size_t size, size_t alignMask) {</span><br><span class="line">void <span class="operator">*</span>p;</span><br><span class="line"><span class="comment">// This check also forces "default" alignment to use AlignedAlloc.</span></span><br><span class="line"><span class="keyword">if</span> (alignMask <span class="operator">&lt;=</span> <span class="type">MALLOC_ALIGN_MASK</span>) {</span><br><span class="line"><span class="keyword">#if</span> defined(__APPLE__)</span><br><span class="line"> p <span class="operator">=</span> malloc_zone_malloc(<span class="type">DEFAULT_ZONE</span>(), size);</span><br><span class="line"><span class="keyword">#else</span></span><br><span class="line"> p <span class="operator">=</span> malloc(size);</span><br><span class="line"><span class="keyword">#endif</span></span><br><span class="line">} <span class="keyword">else</span> {</span><br><span class="line"> size_t alignment <span class="operator">=</span> (alignMask <span class="operator">==</span> <span class="operator">~</span>(size_t(<span class="number">0</span>)))</span><br><span class="line">                        <span class="operator">?</span> _swift_MinAllocationAlignment</span><br><span class="line">                        : alignMask <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line"> p <span class="operator">=</span> <span class="type">AlignedAlloc</span>(size, alignment);</span><br><span class="line">}</span><br><span class="line"><span class="keyword">if</span> (<span class="operator">!</span>p) swift::crash(<span class="string">"Could not allocate memory."</span>);</span><br><span class="line"><span class="keyword">return</span> p;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>函数内部会调用一个swift——slowAlloc 函数，我们来看内部实现</p>
<figure class="highlight swift"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">void <span class="operator">*</span>swift::swift_slowAlloc(size_t size, size_t alignMask) {</span><br><span class="line">void <span class="operator">*</span>p;</span><br><span class="line"><span class="comment">// This check also forces "default" alignment to use AlignedAlloc.</span></span><br><span class="line"><span class="keyword">if</span> (alignMask <span class="operator">&lt;=</span> <span class="type">MALLOC_ALIGN_MASK</span>) {</span><br><span class="line"><span class="keyword">#if</span> defined(__APPLE__)</span><br><span class="line"> p <span class="operator">=</span> malloc_zone_malloc(<span class="type">DEFAULT_ZONE</span>(), size);</span><br><span class="line"><span class="keyword">#else</span></span><br><span class="line"> p <span class="operator">=</span> malloc(size);</span><br><span class="line"><span class="keyword">#endif</span></span><br><span class="line">} <span class="keyword">else</span> {</span><br><span class="line"> size_t alignment <span class="operator">=</span> (alignMask <span class="operator">==</span> <span class="operator">~</span>(size_t(<span class="number">0</span>)))</span><br><span class="line">                        <span class="operator">?</span> _swift_MinAllocationAlignment</span><br><span class="line">                        : alignMask <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line"> p <span class="operator">=</span> <span class="type">AlignedAlloc</span>(size, alignment);</span><br><span class="line">}</span><br><span class="line"><span class="keyword">if</span> (<span class="operator">!</span>p) swift::crash(<span class="string">"Could not allocate memory."</span>);</span><br><span class="line"><span class="keyword">return</span> p;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><code>swift_slowAlloc</code>&nbsp;函数的内部是去进行一些分配内存的操作，比如&nbsp;<code>malloc</code>。所以就印证了类对象实例引用类型-&gt;对象申请堆空间的过程。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://ssj1314.github.io/2022/08/31/test-blog/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="大福禄">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="葫芦小金刚">
      <meta itemprop="description" content="书中自有颜如玉">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 葫芦小金刚">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/08/31/test-blog/" class="post-title-link" itemprop="url">markdown语法吃灰录</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-08-31 11:04:13 / 修改时间：16:44:22" itemprop="dateCreated datePublished" datetime="2022-08-31T11:04:13+08:00">2022-08-31</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="主要特性"><a href="#主要特性" class="headerlink" title="主要特性"></a>主要特性</h3><ul>
<li>支持“标准”Markdown / CommonMark和Github风格的语法，也可变身为代码编辑器；</li>
<li>支持实时预览、图片（跨域）上传、预格式文本/代码/表格插入、代码折叠、搜索替换、只读模式、自定义样式主题和多语言语法高亮等功能；</li>
<li>支持ToC（Table of Contents）、Emoji表情、Task lists、@链接等Markdown扩展语法；</li>
<li>支持TeX科学公式（基于KaTeX）、流程图 Flowchart 和 时序图 Sequence Diagram;</li>
<li>支持识别和解析HTML标签，并且支持自定义过滤标签解析，具有可靠的安全性和几乎无限的扩展性；</li>
<li>支持 AMD / CMD 模块化加载（支持 Require.js &amp; Sea.js），并且支持自定义扩展插件；</li>
<li>兼容主流的浏览器（IE8+）和Zepto.js，且支持iPad等平板设备；</li>
<li>支持自定义主题样式；</li>
</ul>
<h1 id="Editor-md"><a href="#Editor-md" class="headerlink" title="Editor.md"></a>Editor.md</h1><p><img src="https://pandao.github.io/editor.md/images/logos/editormd-logo-180x180.png"></p>
<p><img src="https://img.shields.io/github/stars/pandao/editor.md.svg"> <img src="https://img.shields.io/github/forks/pandao/editor.md.svg"> <img src="https://img.shields.io/github/tag/pandao/editor.md.svg"> <img src="https://img.shields.io/github/release/pandao/editor.md.svg"> <img src="https://img.shields.io/github/issues/pandao/editor.md.svg"> <img src="https://img.shields.io/bower/v/editor.md.svg"></p>
<p><strong>目录 (Table of Contents)</strong></p>
<p>[TOCM]</p>
<p>[TOC]</p>
<h1 id="Heading-1"><a href="#Heading-1" class="headerlink" title="Heading 1"></a>Heading 1</h1><h2 id="Heading-2"><a href="#Heading-2" class="headerlink" title="Heading 2"></a>Heading 2</h2><h3 id="Heading-3"><a href="#Heading-3" class="headerlink" title="Heading 3"></a>Heading 3</h3><h4 id="Heading-4"><a href="#Heading-4" class="headerlink" title="Heading 4"></a>Heading 4</h4><h5 id="Heading-5"><a href="#Heading-5" class="headerlink" title="Heading 5"></a>Heading 5</h5><h6 id="Heading-6"><a href="#Heading-6" class="headerlink" title="Heading 6"></a>Heading 6</h6><h1 id="Heading-1-link-Heading-link"><a href="#Heading-1-link-Heading-link" class="headerlink" title="Heading 1 link Heading link"></a>Heading 1 link <a target="_blank" rel="noopener" href="https://github.com/pandao/editor.md" title="Heading link">Heading link</a></h1><h2 id="Heading-2-link-Heading-link"><a href="#Heading-2-link-Heading-link" class="headerlink" title="Heading 2 link Heading link"></a>Heading 2 link <a target="_blank" rel="noopener" href="https://github.com/pandao/editor.md" title="Heading link">Heading link</a></h2><h3 id="Heading-3-link-Heading-link"><a href="#Heading-3-link-Heading-link" class="headerlink" title="Heading 3 link Heading link"></a>Heading 3 link <a target="_blank" rel="noopener" href="https://github.com/pandao/editor.md" title="Heading link">Heading link</a></h3><h4 id="Heading-4-link-Heading-link-Heading-link-Heading-link"><a href="#Heading-4-link-Heading-link-Heading-link-Heading-link" class="headerlink" title="Heading 4 link Heading link Heading link Heading link"></a>Heading 4 link <a target="_blank" rel="noopener" href="https://github.com/pandao/editor.md" title="Heading link">Heading link</a> Heading link <a target="_blank" rel="noopener" href="https://github.com/pandao/editor.md" title="Heading link">Heading link</a></h4><h5 id="Heading-5-link-Heading-link"><a href="#Heading-5-link-Heading-link" class="headerlink" title="Heading 5 link Heading link"></a>Heading 5 link <a target="_blank" rel="noopener" href="https://github.com/pandao/editor.md" title="Heading link">Heading link</a></h5><h6 id="Heading-6-link-Heading-link"><a href="#Heading-6-link-Heading-link" class="headerlink" title="Heading 6 link Heading link"></a>Heading 6 link <a target="_blank" rel="noopener" href="https://github.com/pandao/editor.md" title="Heading link">Heading link</a></h6><h4 id="标题（用底线的形式）Heading-underline"><a href="#标题（用底线的形式）Heading-underline" class="headerlink" title="标题（用底线的形式）Heading (underline)"></a>标题（用底线的形式）Heading (underline)</h4><h1 id="This-is-an-H1"><a href="#This-is-an-H1" class="headerlink" title="This is an H1"></a>This is an H1</h1><h2 id="This-is-an-H2"><a href="#This-is-an-H2" class="headerlink" title="This is an H2"></a>This is an H2</h2><h3 id="字符效果和横线等"><a href="#字符效果和横线等" class="headerlink" title="字符效果和横线等"></a>字符效果和横线等</h3><hr>
<p><del>删除线</del> <s>删除线（开启识别HTML标签时）</s><br><em>斜体字</em>      <em>斜体字</em><br><strong>粗体</strong>  <strong>粗体</strong><br><em><strong>粗斜体</strong></em> <em><strong>粗斜体</strong></em></p>
<p>上标：X<sub>2</sub>，下标：O<sup>2</sup></p>
<p><strong>缩写(同HTML的abbr标签)</strong></p>
<blockquote>
<p>即更长的单词或短语的缩写形式，前提是开启识别HTML标签时，已默认开启</p>
</blockquote>
<p>The <abbr title="Hyper Text Markup Language">HTML</abbr> specification is maintained by the <abbr title="World Wide Web Consortium">W3C</abbr>.</p>
<h3 id="引用-Blockquotes"><a href="#引用-Blockquotes" class="headerlink" title="引用 Blockquotes"></a>引用 Blockquotes</h3><blockquote>
<p>引用文本 Blockquotes</p>
</blockquote>
<p>引用的行内混合 Blockquotes</p>
<blockquote>
<p>引用：如果想要插入空白换行<code>即&lt;br /&gt;标签</code>，在插入处先键入两个以上的空格然后回车即可，<a target="_blank" rel="noopener" href="http://localhost/">普通链接</a>。</p>
</blockquote>
<h3 id="锚点与链接-Links"><a href="#锚点与链接-Links" class="headerlink" title="锚点与链接 Links"></a>锚点与链接 Links</h3><p><a target="_blank" rel="noopener" href="http://localhost/">普通链接</a></p>
<p><a target="_blank" rel="noopener" href="http://localhost/" title="普通链接带标题">普通链接带标题</a></p>
<p>直接链接：<a target="_blank" rel="noopener" href="https://github.com/">https://github.com</a></p>
<p><a target="_blank" rel="noopener" href="http://www.this-anchor-link.com/">锚点链接</a> </p>
<p>GFM a-tail link @pandao</p>
<blockquote>
<p>@pandao</p>
</blockquote>
<h3 id="多语言代码高亮-Codes"><a href="#多语言代码高亮-Codes" class="headerlink" title="多语言代码高亮 Codes"></a>多语言代码高亮 Codes</h3><h4 id="行内代码-Inline-code"><a href="#行内代码-Inline-code" class="headerlink" title="行内代码 Inline code"></a>行内代码 Inline code</h4><p>执行命令：<code>npm install marked</code></p>
<h4 id="缩进风格"><a href="#缩进风格" class="headerlink" title="缩进风格"></a>缩进风格</h4><p>即缩进四个空格，也做为实现类似<code>&lt;pre&gt;</code>预格式化文本(Preformatted Text)的功能。</p>
<pre><code>&lt;?php
    echo "Hello world!";
?&gt;
</code></pre>
<p>预格式化文本：</p>
<pre><code>| First Header  | Second Header |
| ------------- | ------------- |
| Content Cell  | Content Cell  |
| Content Cell  | Content Cell  |
</code></pre>
<h4 id="JS代码"><a href="#JS代码" class="headerlink" title="JS代码"></a>JS代码</h4><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>){</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">"Hello world!"</span>);</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">(<span class="keyword">function</span>(<span class="params"></span>){</span><br><span class="line">    <span class="keyword">var</span> box = <span class="keyword">function</span>(<span class="params"></span>){</span><br><span class="line">        <span class="keyword">return</span> box.<span class="property">fn</span>.<span class="title function_">init</span>();</span><br><span class="line">    };</span><br><span class="line"></span><br><span class="line">    box.<span class="property"><span class="keyword">prototype</span></span> = box.<span class="property">fn</span> = {</span><br><span class="line">        init : <span class="keyword">function</span>(<span class="params"></span>){</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'box.init()'</span>);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">        },</span><br><span class="line"></span><br><span class="line">		add : <span class="keyword">function</span>(<span class="params">str</span>){</span><br><span class="line">			<span class="title function_">alert</span>(<span class="string">"add"</span>, str);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">		},</span><br><span class="line"></span><br><span class="line">		remove : <span class="keyword">function</span>(<span class="params">str</span>){</span><br><span class="line">			<span class="title function_">alert</span>(<span class="string">"remove"</span>, str);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">		}</span><br><span class="line">    };</span><br><span class="line">    </span><br><span class="line">    box.<span class="property">fn</span>.<span class="property">init</span>.<span class="property"><span class="keyword">prototype</span></span> = box.<span class="property">fn</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">box</span> =box;</span><br><span class="line">})();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> testBox = <span class="title function_">box</span>();</span><br><span class="line">testBox.<span class="title function_">add</span>(<span class="string">"jQuery"</span>).<span class="title function_">remove</span>(<span class="string">"jQuery"</span>);</span><br></pre></td></tr></tbody></table></figure>

<h4 id="HTML代码-HTML-codes"><a href="#HTML代码-HTML-codes" class="headerlink" title="HTML代码 HTML codes"></a>HTML代码 HTML codes</h4><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mate</span> <span class="attr">charest</span>=<span class="string">"utf-8"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Hello world!<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello world!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="图片-Images"><a href="#图片-Images" class="headerlink" title="图片 Images"></a>图片 Images</h3><p>Image:</p>
<p><img src="https://pandao.github.io/editor.md/examples/images/4.jpg"></p>
<blockquote>
<p>Follow your heart.</p>
</blockquote>
<p><img src="https://pandao.github.io/editor.md/examples/images/8.jpg"></p>
<blockquote>
<p>图为：厦门白城沙滩</p>
</blockquote>
<p>图片加链接 (Image + Link)：</p>
<p><a target="_blank" rel="noopener" href="https://pandao.github.io/editor.md/examples/images/7.jpg" title="李健首张专辑《似水流年》封面"><img src="https://pandao.github.io/editor.md/examples/images/7.jpg"></a></p>
<blockquote>
<p>图为：李健首张专辑《似水流年》封面</p>
</blockquote>
<hr>
<h3 id="列表-Lists"><a href="#列表-Lists" class="headerlink" title="列表 Lists"></a>列表 Lists</h3><h4 id="无序列表（减号）Unordered-Lists"><a href="#无序列表（减号）Unordered-Lists" class="headerlink" title="无序列表（减号）Unordered Lists (-)"></a>无序列表（减号）Unordered Lists (-)</h4><ul>
<li>列表一</li>
<li>列表二</li>
<li>列表三</li>
</ul>
<h4 id="无序列表（星号）Unordered-Lists"><a href="#无序列表（星号）Unordered-Lists" class="headerlink" title="无序列表（星号）Unordered Lists (*)"></a>无序列表（星号）Unordered Lists (*)</h4><ul>
<li>列表一</li>
<li>列表二</li>
<li>列表三</li>
</ul>
<h4 id="无序列表（加号和嵌套）Unordered-Lists"><a href="#无序列表（加号和嵌套）Unordered-Lists" class="headerlink" title="无序列表（加号和嵌套）Unordered Lists (+)"></a>无序列表（加号和嵌套）Unordered Lists (+)</h4><ul>
<li>列表一</li>
<li>列表二<ul>
<li>列表二-1</li>
<li>列表二-2</li>
<li>列表二-3</li>
</ul>
</li>
<li>列表三<ul>
<li>列表一</li>
<li>列表二</li>
<li>列表三</li>
</ul>
</li>
</ul>
<h4 id="有序列表-Ordered-Lists"><a href="#有序列表-Ordered-Lists" class="headerlink" title="有序列表 Ordered Lists (-)"></a>有序列表 Ordered Lists (-)</h4><ol>
<li>第一行</li>
<li>第二行</li>
<li>第三行</li>
</ol>
<h4 id="GFM-task-list"><a href="#GFM-task-list" class="headerlink" title="GFM task list"></a>GFM task list</h4><ul>
<li><input checked="" disabled="" type="checkbox"> GFM task list 1</li>
<li><input checked="" disabled="" type="checkbox"> GFM task list 2</li>
<li><input disabled="" type="checkbox"> GFM task list 3<ul>
<li><input disabled="" type="checkbox"> GFM task list 3-1</li>
<li><input disabled="" type="checkbox"> GFM task list 3-2</li>
<li><input disabled="" type="checkbox"> GFM task list 3-3</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> GFM task list 4<ul>
<li><input disabled="" type="checkbox"> GFM task list 4-1</li>
<li><input disabled="" type="checkbox"> GFM task list 4-2</li>
</ul>
</li>
</ul>
<hr>
<h3 id="绘制表格-Tables"><a href="#绘制表格-Tables" class="headerlink" title="绘制表格 Tables"></a>绘制表格 Tables</h3><table>
<thead>
<tr>
<th>项目</th>
<th align="right">价格</th>
<th align="center">数量</th>
</tr>
</thead>
<tbody><tr>
<td>计算机</td>
<td align="right">$1600</td>
<td align="center">5</td>
</tr>
<tr>
<td>手机</td>
<td align="right">$12</td>
<td align="center">12</td>
</tr>
<tr>
<td>管线</td>
<td align="right">$1</td>
<td align="center">234</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>First Header</th>
<th>Second Header</th>
</tr>
</thead>
<tbody><tr>
<td>Content Cell</td>
<td>Content Cell</td>
</tr>
<tr>
<td>Content Cell</td>
<td>Content Cell</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>First Header</th>
<th>Second Header</th>
</tr>
</thead>
<tbody><tr>
<td>Content Cell</td>
<td>Content Cell</td>
</tr>
<tr>
<td>Content Cell</td>
<td>Content Cell</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>Function name</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>help()</code></td>
<td>Display the help window.</td>
</tr>
<tr>
<td><code>destroy()</code></td>
<td><strong>Destroy your computer!</strong></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th align="left">Left-Aligned</th>
<th align="center">Center Aligned</th>
<th align="right">Right Aligned</th>
</tr>
</thead>
<tbody><tr>
<td align="left">col 3 is</td>
<td align="center">some wordy text</td>
<td align="right">$1600</td>
</tr>
<tr>
<td align="left">col 2 is</td>
<td align="center">centered</td>
<td align="right">$12</td>
</tr>
<tr>
<td align="left">zebra stripes</td>
<td align="center">are neat</td>
<td align="right">$1</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>Item</th>
<th align="right">Value</th>
</tr>
</thead>
<tbody><tr>
<td>Computer</td>
<td align="right">$1600</td>
</tr>
<tr>
<td>Phone</td>
<td align="right">$12</td>
</tr>
<tr>
<td>Pipe</td>
<td align="right">$1</td>
</tr>
</tbody></table>
<hr>
<h4 id="特殊符号-HTML-Entities-Codes"><a href="#特殊符号-HTML-Entities-Codes" class="headerlink" title="特殊符号 HTML Entities Codes"></a>特殊符号 HTML Entities Codes</h4><p>&amp;copy; &amp;  &amp;uml; &amp;trade; &amp;iexcl; &amp;pound;<br>&amp; &lt; &gt; &amp;yen; &amp;euro; &amp;reg; &amp;plusmn; &amp;para; &amp;sect; &amp;brvbar; &amp;macr; &amp;laquo; &amp;middot; </p>
<p>X&amp;sup2; Y&amp;sup3; &amp;frac34; &amp;frac14;  &amp;times;  &amp;divide;   &amp;raquo;</p>
<p>18&amp;ordm;C  "  &amp;apos;</p>
<h3 id="Emoji表情-smiley"><a href="#Emoji表情-smiley" class="headerlink" title="Emoji表情 :smiley:"></a>Emoji表情 <span class="github-emoji"><span>😃</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f603.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span></h3><blockquote>
<p>Blockquotes <span class="github-emoji"><span>⭐</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span></p>
</blockquote>
<h4 id="GFM-task-lists-amp-Emoji-amp-fontAwesome-icon-emoji-amp-editormd-logo-emoji-editormd-logo-5x"><a href="#GFM-task-lists-amp-Emoji-amp-fontAwesome-icon-emoji-amp-editormd-logo-emoji-editormd-logo-5x" class="headerlink" title="GFM task lists &amp; Emoji &amp; fontAwesome icon emoji &amp; editormd logo emoji :editormd-logo-5x:"></a>GFM task lists &amp; Emoji &amp; fontAwesome icon emoji &amp; editormd logo emoji :editormd-logo-5x:</h4><ul>
<li><input checked="" disabled="" type="checkbox"> <span class="github-emoji"><span>😃</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f603.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> @mentions, <span class="github-emoji"><span>😃</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f603.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> #refs, <a href="">links</a>, <strong>formatting</strong>, and <del>tags</del> supported :editormd-logo:;</li>
<li><input checked="" disabled="" type="checkbox"> list syntax required (any unordered or ordered list supported) :editormd-logo-3x:;</li>
<li><input checked="" disabled="" type="checkbox"> [ ] <span class="github-emoji"><span>😃</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f603.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> this is a complete item <span class="github-emoji"><span>😃</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f603.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>;</li>
<li><input disabled="" type="checkbox"> []this is an incomplete item <a href="#">test link</a> :fa-star: @pandao; </li>
<li><input disabled="" type="checkbox"> [ ]this is an incomplete item :fa-star: :fa-gear:;<ul>
<li><input disabled="" type="checkbox"> <span class="github-emoji"><span>😃</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f603.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> this is an incomplete item <a href="#">test link</a> :fa-star: :fa-gear:;</li>
<li><input disabled="" type="checkbox"> <span class="github-emoji"><span>😃</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f603.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> this is  :fa-star: :fa-gear: an incomplete item <a href="#">test link</a>;</li>
</ul>
</li>
</ul>
<h4 id="反斜杠-Escape"><a href="#反斜杠-Escape" class="headerlink" title="反斜杠 Escape"></a>反斜杠 Escape</h4><p>*literal asterisks*</p>
<h3 id="科学公式-TeX-KaTeX"><a href="#科学公式-TeX-KaTeX" class="headerlink" title="科学公式 TeX(KaTeX)"></a>科学公式 TeX(KaTeX)</h3><p>$$E=mc^2$$</p>
<p>行内的公式$$E=mc^2$$行内的公式，行内的$$E=mc^2$$公式。</p>
<p>$$(\sqrt{3x-1}+(1+x)^2)$$</p>
<p>$$\sin(\alpha)^{\theta}=\sum_{i=0}^{n}(x^i + \cos(f))$$</p>
<p>多行公式：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">\displaystyle</span><br><span class="line">\left( \sum\_{k=1}^n a\_k b\_k \right)^2</span><br><span class="line">\leq</span><br><span class="line">\left( \sum\_{k=1}^n a\_k^2 \right)</span><br><span class="line">\left( \sum\_{k=1}^n b\_k^2 \right)</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">\displaystyle </span><br><span class="line">    \frac{1}{</span><br><span class="line">        \Bigl(\sqrt{\phi \sqrt{5}}-\phi\Bigr) e^{</span><br><span class="line">        \frac25 \pi}} = 1+\frac{e^{-2\pi}} {1+\frac{e^{-4\pi}} {</span><br><span class="line">        1+\frac{e^{-6\pi}}</span><br><span class="line">        {1+\frac{e^{-8\pi}}</span><br><span class="line">         {1+\cdots} }</span><br><span class="line">        } </span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight latex"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">f(x) = <span class="keyword">\int</span><span class="built_in">_</span>{-<span class="keyword">\infty</span>}<span class="built_in">^</span><span class="keyword">\infty</span></span><br><span class="line">    <span class="keyword">\hat</span> f(<span class="keyword">\xi</span>)<span class="keyword">\,</span>e<span class="built_in">^</span>{2 <span class="keyword">\pi</span> i <span class="keyword">\xi</span> x}</span><br><span class="line">    <span class="keyword">\,</span>d<span class="keyword">\xi</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="绘制流程图-Flowchart"><a href="#绘制流程图-Flowchart" class="headerlink" title="绘制流程图 Flowchart"></a>绘制流程图 Flowchart</h3><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">st=&gt;start: 用户登陆</span><br><span class="line">op=&gt;operation: 登陆操作</span><br><span class="line">cond=&gt;condition: 登陆成功 Yes or No?</span><br><span class="line">e=&gt;end: 进入后台</span><br><span class="line"></span><br><span class="line">st-&gt;op-&gt;cond</span><br><span class="line">cond(yes)-&gt;e</span><br><span class="line">cond(no)-&gt;op</span><br></pre></td></tr></tbody></table></figure>
<h3 id="绘制序列图-Sequence-Diagram"><a href="#绘制序列图-Sequence-Diagram" class="headerlink" title="绘制序列图 Sequence Diagram"></a>绘制序列图 Sequence Diagram</h3><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Andrew-&gt;China: Says Hello </span><br><span class="line">Note right of China: China thinks\nabout it </span><br><span class="line">China--&gt;Andrew: How are you? </span><br><span class="line">Andrew-&gt;&gt;China: I am good thanks!</span><br></pre></td></tr></tbody></table></figure>

<h3 id="End"><a href="#End" class="headerlink" title="End"></a>End</h3>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://ssj1314.github.io/2022/08/31/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="大福禄">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="葫芦小金刚">
      <meta itemprop="description" content="书中自有颜如玉">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 葫芦小金刚">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/08/31/hello-world/" class="post-title-link" itemprop="url">Hello World</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-08-31 10:58:36" itemprop="dateCreated datePublished" datetime="2022-08-31T10:58:36+08:00">2022-08-31</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></tbody></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></tbody></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></tbody></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></tbody></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>





</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">大福禄</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
